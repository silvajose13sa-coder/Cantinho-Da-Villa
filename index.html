// ===============================
// CARRINHO DE COMPRAS
// ===============================

let carrinho = [];
let carrinhoAberto = false;

// Criar carrinho visual automaticamente
document.addEventListener("DOMContentLoaded", () => {
  const carrinhoHTML = `
    <div id="carrinho-btn" onclick="toggleCarrinho()">
      üõí <span id="contador-carrinho">0</span>
    </div>

    <div id="carrinho-box">
      <h3>üõí Seu Carrinho</h3>
      <ul id="lista-carrinho"></ul>
      <p id="total-carrinho">Total: R$ 0,00</p>
      <button onclick="finalizarPedido()">Finalizar Pedido</button>
    </div>
  `;

  document.body.insertAdjacentHTML("beforeend", carrinhoHTML);
  aplicarEstiloCarrinho();
});

// ===============================
// FUN√á√ïES DO CARRINHO
// ===============================

function adicionarCarrinho(nome, preco) {
  carrinho.push({ nome, preco });
  atualizarCarrinho();
}

function atualizarCarrinho() {
  const lista = document.getElementById("lista-carrinho");
  const totalEl = document.getElementById("total-carrinho");
  const contador = document.getElementById("contador-carrinho");

  lista.innerHTML = "";
  let total = 0;

  carrinho.forEach((item, index) => {
    total += item.preco;

    const li = document.createElement("li");
    li.innerHTML = `
      ${item.nome} - R$ ${item.preco.toFixed(2)}
      <span onclick="removerItem(${index})">‚ùå</span>
    `;
    lista.appendChild(li);
  });

  totalEl.innerText = `Total: R$ ${total.toFixed(2)}`;
  contador.innerText = carrinho.length;
}

function removerItem(index) {
  carrinho.splice(index, 1);
  atualizarCarrinho();
}

function toggleCarrinho() {
  const box = document.getElementById("carrinho-box");
  carrinhoAberto = !carrinhoAberto;
  box.style.display = carrinhoAberto ? "block" : "none";
}

function finalizarPedido() {
  if (carrinho.length === 0) {
    alert("Seu carrinho est√° vazio üòÖ");
    return;
  }

  let mensagem = "üõí Pedido Cantinho da Villa:%0A";
  let total = 0;

  carrinho.forEach(item => {
    mensagem += `- ${item.nome} (R$ ${item.preco.toFixed(2)})%0A`;
    total += item.preco;
  });

  mensagem += `%0ATotal: R$ ${total.toFixed(2)}`;

  window.open(`https://wa.me/5511913533982?text=${mensagem}`, "_blank");
}

// ===============================
// ESTILO DO CARRINHO (JS INJETADO)
// ===============================

function aplicarEstiloCarrinho() {
  const style = document.createElement("style");
  style.innerHTML = `
    #carrinho-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #d32f2f;
      color: #fff;
      padding: 15px 18px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 9999;
    }

    #carrinho-btn span {
      background: #fff;
      color: #d32f2f;
      padding: 3px 8px;
      border-radius: 50%;
      margin-left: 6px;
    }

    #carrinho-box {
      position: fixed;
      bottom: 90px;
      right: 20px;
      background: #fff;
      width: 260px;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      display: none;
      z-index: 9999;
    }

    #carrinho-box h3 {
      margin-top: 0;
      color: #d32f2f;
      text-align: center;
    }

    #lista-carrinho {
      list-style: none;
      padding: 0;
      max-height: 150px;
      overflow-y: auto;
    }

    #lista-carrinho li {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 6px;
    }

    #lista-carrinho span {
      cursor: pointer;
    }

    #carrinho-box button {
      width: 100%;
      background: #388e3c;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }

    #carrinho-box button:hover {
      background: #2e7d32;
    }
  `;
  document.head.appendChild(style);
}
